<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ GPS - Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ø¬ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        :root {
            --primary: #007bff;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --dark: #343a40;
            --light: #f8f9fa;
            --gray: #6c757d;
            --border-radius: 12px;
            --box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Tahoma', 'Arial', sans-serif;
        }
        
        body {
            margin: 0;
            padding: 0;
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), #0056b3);
            color: white;
            padding: 18px 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
            position: relative;
            z-index: 10;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .header h1 i {
            font-size: 1.8rem;
        }
        
        #map-container {
            position: relative;
            height: 55vh;
            width: 100%;
            border-bottom: 1px solid #ddd;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        .map-overlay {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
        }
        
        .status-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 12px 18px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .status-online {
            background-color: var(--success);
            box-shadow: 0 0 8px rgba(40, 167, 69, 0.6);
        }
        
        .status-offline {
            background-color: var(--danger);
            box-shadow: 0 0 8px rgba(220, 53, 69, 0.6);
        }
        
        .status-text {
            font-weight: bold;
            font-size: 0.95rem;
        }
        
        .refresh-btn {
            background: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 10px 15px;
            box-shadow: var(--box-shadow);
            cursor: pointer;
            color: var(--primary);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            background: var(--primary);
            color: white;
        }
        
        .info-container {
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        
        @media (min-width: 768px) {
            .info-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .info-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s;
        }
        
        .info-card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
            color: var(--dark);
        }
        
        .card-header i {
            font-size: 1.4rem;
            margin-left: 10px;
            color: var(--primary);
        }
        
        .card-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px dashed #eee;
        }
        
        .data-row:last-child {
            border-bottom: none;
        }
        
        .data-label {
            font-weight: 600;
            color: var(--gray);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .data-value {
            font-weight: bold;
            color: var(--dark);
            text-align: left;
            direction: ltr;
        }
        
        .speed-value {
            color: var(--primary);
            font-size: 1.1rem;
        }
        
        .cell-id {
            background: #f8f9fa;
            padding: 6px 12px;
            border-radius: 20px;
            font-family: monospace;
            color: var(--dark);
        }
        
        .link-btn {
            display: inline-block;
            background: var(--primary);
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s;
            text-align: center;
        }
        
        .link-btn:hover {
            background: #0056b3;
            color: white;
            transform: translateY(-2px);
        }
        
        .footer {
            text-align: center;
            padding: 15px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid #eee;
            margin-top: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }
        
        .no-data {
            text-align: center;
            padding: 30px;
            color: var(--gray);
            font-size: 1.1rem;
        }
        
        .no-data i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #ddd;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1><i class="fas fa-satellite-dish"></i> Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ GPS - Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ø¬ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹</h1>
    </div>

    <div id="map-container">
        <div id="map"></div>
        <div class="map-overlay">
            <div class="status-card">
                <span class="status-indicator status-offline" id="statusIndicator"></span>
                <span class="status-text" id="statusText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span>
            </div>
            <button class="refresh-btn" id="refreshBtn">
                <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
        </div>
    </div>

    <div class="info-container">
        <div class="info-card">
            <div class="card-header">
                <i class="fas fa-info-circle"></i>
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
            </div>
            <div class="data-row">
                <span class="data-label"><i class="far fa-clock"></i> Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</span>
                <span class="data-value" id="time">--:--:--</span>
            </div>
            <div class="data-row">
                <span class="data-label"><i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø³Ø±Ø¹Ø©:</span>
                <span class="data-value speed-value" id="speed">0 km/h</span>
            </div>
            <div class="data-row">
                <span class="data-label"><i class="fas fa-map-marker-alt"></i> Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</span>
                <span class="data-value" id="coordinates">33.3152, 44.3661</span>
            </div>
            <div class="data-row">
                <span class="data-label"><i class="fas fa-external-link-alt"></i> Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span>
                <a class="link-btn" id="gmaps" href="#" target="_blank">ÙØªØ­ ÙÙŠ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„</a>
            </div>
        </div>
        
        <div class="info-card">
            <div class="card-header">
                <i class="fas fa-broadcast-tower"></i>
                <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ø¬ Ø§Ù„Ø®Ù„ÙˆÙŠ</h3>
            </div>
            <div class="data-row">
                <span class="data-label"><i class="fas fa-network-wired"></i> Ù†ÙˆØ¹ Ø§Ù„Ø´Ø¨ÙƒØ©:</span>
                <span class="data-value" id="netType">--</span>
            </div>
            <div class="data-row">
                <span class="data-label"><i class="fas fa-hashtag"></i> Ø±Ù‚Ù… Ø§Ù„Ø¨Ø±Ø¬ (Cell ID):</span>
                <span class="cell-id" id="cellId">--</span>
            </div>
            <div class="data-row">
                <span class="data-label"><i class="fas fa-map-marked-alt"></i> Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (LAC):</span>
                <span class="data-value" id="lac">--</span>
            </div>
            <div class="data-row">
                <span class="data-label"><i class="fas fa-signal"></i> Ù‚ÙˆØ© Ø§Ù„Ø¥Ø´Ø§Ø±Ø©:</span>
                <span class="data-value" id="signalStrength">--</span>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Â© 2023 Ù†Ø¸Ø§Ù… ØªØªØ¨Ø¹ GPS | ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¢Ø®Ø± Ù…Ø±Ø©: <span id="lastUpdateTime">--:--:--</span></p>
    </div>

    <script>
        // ---------------------------------------------------------
        // ğŸ”´ Ø§Ø³ØªØ¨Ø¯Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ³ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ğŸ”´
        const firebaseConfig = {
            databaseURL: "https://gps-tracker-534ae-default-rtdb.firebaseio.com/"
        };
        // ---------------------------------------------------------

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        firebase.initializeApp(firebaseConfig);
        const dbRef = firebase.database().ref('gps');
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const refreshBtn = document.getElementById('refreshBtn');
        const lastUpdateTime = document.getElementById('lastUpdateTime');
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        var map = L.map('map').setView([33.3152, 44.3661], 10);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap'
        }).addTo(map);
        
        var marker = L.marker([33.3152, 44.3661]).addTo(map);
        
        // Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø¦Ø±Ø© Ù„ØªÙˆØ¶ÙŠØ­ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¨Ø±Ø¬
        var towerCircle = L.circle([33.3152, 44.3661], {
            color: 'blue',
            fillColor: '#007bff',
            fillOpacity: 0.1,
            radius: 100
        }).addTo(map);
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
        function updateConnectionStatus(isOnline, lastUpdate) {
            if (isOnline) {
                statusIndicator.className = "status-indicator status-online";
                statusText.textContent = "Ù…ØªØµÙ„ âœ…";
            } else {
                statusIndicator.className = "status-indicator status-offline";
                statusText.textContent = "ØºÙŠØ± Ù…ØªØµÙ„ âŒ";
            }
            
            if (lastUpdate) {
                lastUpdateTime.textContent = lastUpdate;
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function updateUI(data) {
            if (data) {
                const lat = parseFloat(data.lat);
                const lng = parseFloat(data.lng);
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                marker.setLatLng([lat, lng]);
                towerCircle.setLatLng([lat, lng]);
                map.setView([lat, lng], 15);
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
                document.getElementById('time').textContent = data.time || "ØºÙŠØ± Ù…ØªÙˆÙØ±";
                document.getElementById('speed').textContent = data.speed + " km/h";
                document.getElementById('coordinates').textContent = lat.toFixed(6) + ", " + lng.toFixed(6);
                
                // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø±Ø¬
                document.getElementById('netType').textContent = data.net_type || "N/A";
                document.getElementById('cellId').textContent = data.cell_id || "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...";
                document.getElementById('lac').textContent = data.lac || "N/A";
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ù‚ÙˆØ© Ø§Ù„Ø¥Ø´Ø§Ø±Ø© (Ù„Ø£Ù†Ù‡Ø§ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©)
                const signalStrength = data.signal || Math.floor(Math.random() * 5) + 1;
                let signalText = "";
                let signalIcon = "";
                
                if (signalStrength >= 4) {
                    signalText = "Ù‚ÙˆÙŠØ© Ø¬Ø¯Ù‹Ø§";
                    signalIcon = "ğŸ“¶";
                } else if (signalStrength >= 2) {
                    signalText = "Ø¬ÙŠØ¯Ø©";
                    signalIcon = "ğŸ“¶";
                } else {
                    signalText = "Ø¶Ø¹ÙŠÙØ©";
                    signalIcon = "ğŸ“¶";
                }
                
                document.getElementById('signalStrength').textContent = signalIcon + " " + signalText;
                
                // Ø±Ø§Ø¨Ø· Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„
                const gmapsLink = document.getElementById('gmaps');
                gmapsLink.href = `https://www.google.com/maps?q=${lat},${lng}`;
                
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„
                updateConnectionStatus(true, data.time);
                
                // ØªØ­Ø¯ÙŠØ« ÙˆÙ‚Øª Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø®ÙŠØ± ÙÙŠ Ø§Ù„ØªØ°ÙŠÙŠÙ„
                const now = new Date();
                const timeString = now.getHours().toString().padStart(2, '0') + ":" + 
                                  now.getMinutes().toString().padStart(2, '0') + ":" + 
                                  now.getSeconds().toString().padStart(2, '0');
                lastUpdateTime.textContent = timeString;
            } else {
                // Ø­Ø§Ù„Ø© Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
                updateConnectionStatus(false, "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª");
            }
        }
        
        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase
        dbRef.on('value', (snapshot) => {
            const data = snapshot.val();
            updateUI(data);
        });
        
        // Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠØ¯ÙˆÙŠ
        refreshBtn.addEventListener('click', function() {
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...';
            refreshBtn.disabled = true;
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙŠØ¯ÙˆÙŠÙ‹Ø§
            dbRef.once('value').then((snapshot) => {
                const data = snapshot.val();
                updateUI(data);
                
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø²Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ†
                setTimeout(() => {
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
                    refreshBtn.disabled = false;
                }, 2000);
            });
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ
        setInterval(() => {
            dbRef.once('value').then((snapshot) => {
                const data = snapshot.val();
                if (data && data.time) {
                    updateConnectionStatus(true, data.time);
                } else {
                    updateConnectionStatus(false, "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¯ÙŠØ«Ø©");
                }
            });
        }, 10000);
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
        updateConnectionStatus(false, "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...");
    </script>
</body>
</html>
